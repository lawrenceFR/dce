<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Content-Centric Networking in Java: org.ccnx.ccn.impl.sync.SliceComparator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><b>org</b>.<b>ccnx</b>.<b>ccn</b>.<a class="el" href="namespaceorg_1_1ccnx_1_1ccn_1_1impl.html">impl</a>.<b>sync</b>.<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html">SliceComparator</a>
  </div>
</div>
<div class="contents">
<h1>org.ccnx.ccn.impl.sync.SliceComparator Class Reference</h1><!-- doxytag: class="org::ccnx::ccn::impl::sync::SliceComparator" --><!-- doxytag: inherits="Runnable" -->
<p>This class is the main comparator used to decode sync items and determine what has newly been seen that has not already been seen.  
<a href="#_details">More...</a></p>

<p><a href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator_1_1_node_fetch_handler.html">NodeFetchHandler</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get back data from a node fetch request.  <a href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator_1_1_node_fetch_handler.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><b>SyncCompareState</b> { <b>INIT</b>, 
<b>PRELOAD</b>, 
<b>COMPARE</b>, 
<b>DONE</b>
 }</td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#ab0e7b1519abc0a6502ff978218fa3a49">SliceComparator</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_protocol_based_sync_monitor.html">ProtocolBasedSyncMonitor</a> pbsm, <a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_sync_handler.html">CCNSyncHandler</a> callback, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1io_1_1content_1_1_config_slice.html">ConfigSlice</a> slice, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> startHash, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a> startName, <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a> handle)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start a comparison on a slice which will call back "callback" each time a previously unseen name is seen.  <a href="#ab0e7b1519abc0a6502ff978218fa3a49"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">boolean&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#a584ec857c066726ccdd677e420f604ff">addPending</a> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> ste)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add new data into the system - either a hash which must be looked up or node data which can be directly decoded.  <a href="#a584ec857c066726ccdd677e420f604ff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#a1a83aa3ccca98a6bf155b90c8a481c52">addPendingContent</a> (byte[] data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add pending hash from seen data.  <a href="#a1a83aa3ccca98a6bf155b90c8a481c52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_sync_handler.html">CCNSyncHandler</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#a15598b577e10984206ec37ac67531cc6">getCallback</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get callback associated with this comparator.  <a href="#a15598b577e10984206ec37ac67531cc6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a42ea0bac93f7105029ee302aaea422e0"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::kickCompare" ref="a42ea0bac93f7105029ee302aaea422e0" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#a42ea0bac93f7105029ee302aaea422e0">kickCompare</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start compare process if not already running. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#ac30dfa3d06b2f26cb549242396b684e2">run</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Separate thread for running comparisons.  <a href="#ac30dfa3d06b2f26cb549242396b684e2"></a><br/></td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ae3339f8297e7879d61087dc8915931"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_executor" ref="a6ae3339f8297e7879d61087dc8915931" args="" -->
ScheduledThreadPoolExecutor&nbsp;</td><td class="memItemRight" valign="bottom"><b>_executor</b> = (ScheduledThreadPoolExecutor) Executors.newScheduledThreadPool(1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3babc3481c73295559cf9ab7d7f84477"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::COMPARE_INTERVAL" ref="a3babc3481c73295559cf9ab7d7f84477" args="" -->
final int&nbsp;</td><td class="memItemRight" valign="bottom"><b>COMPARE_INTERVAL</b> = 100</td></tr>
<tr><td colspan="2"><h2>Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1f2b3dbcb8440f8e3c785c1aa3b66f06"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::DECODER_SIZE" ref="a1f2b3dbcb8440f8e3c785c1aa3b66f06" args="" -->
static final int&nbsp;</td><td class="memItemRight" valign="bottom"><b>DECODER_SIZE</b> = 756</td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#a3e800b597dbd09f1c65c6aa308560d48">getPending</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the best (highest hash) pending entry for a new comparison.  <a href="#a3e800b597dbd09f1c65c6aa308560d48"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8094fbede3d53e4f270f18950799e0a3"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::getPendingContent" ref="a8094fbede3d53e4f270f18950799e0a3" args="()" -->
byte[]&nbsp;</td><td class="memItemRight" valign="bottom"><b>getPendingContent</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#acd7672a18c868b5b028c546ddba97c5e">checkNextRound</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Restart compare process if its not currently in process.  <a href="#acd7672a18c868b5b028c546ddba97c5e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aea3df6e36a09dfd6a9a32a3702050355"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::push" ref="aea3df6e36a09dfd6a9a32a3702050355" args="(SyncTreeEntry srt, Stack&lt; SyncTreeEntry &gt; stack)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>push</b> (<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> srt, Stack&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt; stack)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00ba7ca7ac0dfabc2f7a4ba988f5d634"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::pop" ref="a00ba7ca7ac0dfabc2f7a4ba988f5d634" args="(Stack&lt; SyncTreeEntry &gt; stack)" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>pop</b> (Stack&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt; stack)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5b98cf9b6dcb21d011b9ec204219f05a"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::getHead" ref="a5b98cf9b6dcb21d011b9ec204219f05a" args="(Stack&lt; SyncTreeEntry &gt; stack)" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>getHead</b> (Stack&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt; stack)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#ae85c4c1395e3ea909469c453054436ce">nextRound</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start a new round of comparison.  <a href="#ae85c4c1395e3ea909469c453054436ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator.html#ac5959d639a00dc604cd539aeda84871b">updateCurrent</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">We keep a running tree of what we already have in "X".  <a href="#ac5959d639a00dc604cd539aeda84871b"></a><br/></td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99b5afd1ae85488885bddff2ff4d992a"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_decoder" ref="a99b5afd1ae85488885bddff2ff4d992a" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1encoding_1_1_binary_x_m_l_decoder.html">BinaryXMLDecoder</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_decoder</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a3b04a7f4b6ac39ddb961c7b57e3051"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_timerLock" ref="a3a3b04a7f4b6ac39ddb961c7b57e3051" args="" -->
Object&nbsp;</td><td class="memItemRight" valign="bottom"><b>_timerLock</b> = new Object()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a56eafdc8497925a167e8f8dd34556b37"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_needToCompare" ref="a56eafdc8497925a167e8f8dd34556b37" args="" -->
boolean&nbsp;</td><td class="memItemRight" valign="bottom"><b>_needToCompare</b> = true</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a69eab3b13bed2ce66a57ed27fb23f9b8"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_comparing" ref="a69eab3b13bed2ce66a57ed27fb23f9b8" args="" -->
boolean&nbsp;</td><td class="memItemRight" valign="bottom"><b>_comparing</b> = false</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a59dd0c18ad3578cfb0367dd88a1d590d"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_compareSemaphore" ref="a59dd0c18ad3578cfb0367dd88a1d590d" args="" -->
Semaphore&nbsp;</td><td class="memItemRight" valign="bottom"><b>_compareSemaphore</b> = new Semaphore(1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7df7170e0bf5f1e6de5baf72552ae86d"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_nfh" ref="a7df7170e0bf5f1e6de5baf72552ae86d" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator_1_1_node_fetch_handler.html">NodeFetchHandler</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_nfh</b> = new <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_slice_comparator_1_1_node_fetch_handler.html">NodeFetchHandler</a>()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab16397f3852a8ff2238a22c839315fcf"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_compareLock" ref="ab16397f3852a8ff2238a22c839315fcf" args="" -->
Object&nbsp;</td><td class="memItemRight" valign="bottom"><b>_compareLock</b> = new Object()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aec78cf6dd8edf68955f34536c3885fab"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_slice" ref="aec78cf6dd8edf68955f34536c3885fab" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1io_1_1content_1_1_config_slice.html">ConfigSlice</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_slice</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae174185790959ad0a6a9d5380819e87e"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_callback" ref="ae174185790959ad0a6a9d5380819e87e" args="" -->
<a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_sync_handler.html">CCNSyncHandler</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_callback</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af7f2d7ad277cd31525ea3cb76d419a08"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_handle" ref="af7f2d7ad277cd31525ea3cb76d419a08" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_handle</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a49d03d857a955a2648619eafc97f79b5"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_pbsm" ref="a49d03d857a955a2648619eafc97f79b5" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_protocol_based_sync_monitor.html">ProtocolBasedSyncMonitor</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_pbsm</b> = null</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a888af942d2a4a424c1ade80e3ff3d8b0"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_current" ref="a888af942d2a4a424c1ade80e3ff3d8b0" args="" -->
Stack&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_current</b> = new Stack&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&gt;()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a62eb8a8122799730b636e26936d1e256"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_next" ref="a62eb8a8122799730b636e26936d1e256" args="" -->
Stack&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_next</b> = new Stack&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&gt;()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0c5cb2212f8620e7431eb3f439429c37"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_state" ref="a0c5cb2212f8620e7431eb3f439429c37" args="" -->
SyncCompareState&nbsp;</td><td class="memItemRight" valign="bottom"><b>_state</b> = SyncCompareState.INIT</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8348424e05da9466f2049e83b39fe0f8"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_pendingEntries" ref="a8348424e05da9466f2049e83b39fe0f8" args="" -->
ArrayList&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_pendingEntries</b> = new ArrayList&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&gt;()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a186d4db0eb05a77d4c2cd6aa4176805e"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_pendingContent" ref="a186d4db0eb05a77d4c2cd6aa4176805e" args="" -->
Queue&lt; byte[]&gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_pendingContent</b> = new ConcurrentLinkedQueue&lt;byte[]&gt;()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abd3cc40e5190dc0976260b27d6a8b515"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_currentRoot" ref="abd3cc40e5190dc0976260b27d6a8b515" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_currentRoot</b> = null</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac4798a4def362b8b37de725de8e733de"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_startHash" ref="ac4798a4def362b8b37de725de8e733de" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_startHash</b> = null</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aca2dcc762a3724cfcd1749c7ab3b4912"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_startName" ref="aca2dcc762a3724cfcd1749c7ab3b4912" args="" -->
<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>_startName</b> = null</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5e579581517a7e8c53b006a850fd6b6b"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_doCallbacks" ref="a5e579581517a7e8c53b006a850fd6b6b" args="" -->
boolean&nbsp;</td><td class="memItemRight" valign="bottom"><b>_doCallbacks</b> = true</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e2c453b53eb6f2964bacbb854c9f09f"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::_updateNames" ref="a9e2c453b53eb6f2964bacbb854c9f09f" args="" -->
TreeSet&lt; <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a> &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_updateNames</b> = new TreeSet&lt;<a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a>&gt;()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This class is the main comparator used to decode sync items and determine what has newly been seen that has not already been seen. </p>
<p>The algorithm is based on the similar one implemented in the C code.</p>
<p>The basic idea is that we do a continuous compare of hash trees arriving from sync. The first hash tree of course will contain all names that have not been seen before. After that we do a double tree walk of the the "last" (labeled 'X') and the new (labeled 'Y') hash trees. As we walk we compare the trees to find nodes that are as yet unseen and report the results (a ContentName) to the user via a callback. Every hash that has been walked through in the 'Y' phase is marked 'covered' so that we can immediately discard any exactly matching hashes we see in the future. Since incoming hashes can be disjoint, at the start of each new comparison, we also update the X tree to contain any new items which were seen on the last pass. This can often cause the construction of new hashes which are not the same as hashes we have seen from the network.</p>
<p>New hashes seen from the network are fed into the system via the "addPending" methods.</p>
<p>Note: We purposely don't decode SyncNodeComposites in handlers since they are big and slow and we risk timing out the handler by doing so. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab0e7b1519abc0a6502ff978218fa3a49"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::SliceComparator" ref="ab0e7b1519abc0a6502ff978218fa3a49" args="(ProtocolBasedSyncMonitor pbsm, CCNSyncHandler callback, ConfigSlice slice, SyncTreeEntry startHash, ContentName startName, CCNHandle handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">org.ccnx.ccn.impl.sync.SliceComparator.SliceComparator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_protocol_based_sync_monitor.html">ProtocolBasedSyncMonitor</a>&nbsp;</td>
          <td class="paramname"> <em>pbsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_sync_handler.html">CCNSyncHandler</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1io_1_1content_1_1_config_slice.html">ConfigSlice</a>&nbsp;</td>
          <td class="paramname"> <em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td>
          <td class="paramname"> <em>startHash</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1protocol_1_1_content_name.html">ContentName</a>&nbsp;</td>
          <td class="paramname"> <em>startName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html">CCNHandle</a>&nbsp;</td>
          <td class="paramname"> <em>handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start a comparison on a slice which will call back "callback" each time a previously unseen name is seen. </p>
<p>Note that with the 0 length hash we can only base the "start" of our reporting on the hash we get back from the root advise request. If there is more than one repository reporting and the first answer we get is disjoint from some other answer, we may receive names later that are earlier than the "start" so this is just a best attempt.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pbsm</em>&nbsp;</td><td>the <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_monitor.html">SyncMonitor</a> which created us </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>callback to user code </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>slice</em>&nbsp;</td><td>corresponding slice </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>startHash</em>&nbsp;</td><td>if null, report all names seen, if 0 length attempt to not report anything before this was called, if contains a hash, report all names that are not in that hash. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>startName</em>&nbsp;</td><td>report all names seen after we see this name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>the <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1_c_c_n_handle.html" title="The core class encapsulating a Java interface to the CCN network.">CCNHandle</a> to use </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a584ec857c066726ccdd677e420f604ff"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::addPending" ref="a584ec857c066726ccdd677e420f604ff" args="(SyncTreeEntry ste)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boolean org.ccnx.ccn.impl.sync.SliceComparator.addPending </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a>&nbsp;</td>
          <td class="paramname"> <em>ste</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add new data into the system - either a hash which must be looked up or node data which can be directly decoded. </p>
<p>These will be used to start a new hash tree for the next compare when the current one has completed.</p>
<p>These will normally be called by handlers in <a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_protocol_based_sync_monitor.html" title="Snoops on the sync protocol to report new files seen by sync on a slice to a registered...">ProtocolBasedSyncMonitor</a> so it is therefore handler code (so we should not decode anything here).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ste</em>&nbsp;</td><td>entry for new hash </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div>
<a class="anchor" id="a1a83aa3ccca98a6bf155b90c8a481c52"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::addPendingContent" ref="a1a83aa3ccca98a6bf155b90c8a481c52" args="(byte[] data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.impl.sync.SliceComparator.addPendingContent </td>
          <td>(</td>
          <td class="paramtype">byte[]&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add pending hash from seen data. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data seen. The hash isn't known until we decode the data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="acd7672a18c868b5b028c546ddba97c5e"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::checkNextRound" ref="acd7672a18c868b5b028c546ddba97c5e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.impl.sync.SliceComparator.checkNextRound </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Restart compare process if its not currently in process. </p>
<p>Must be called synchronized with "this". </p>

</div>
</div>
<a class="anchor" id="a15598b577e10984206ec37ac67531cc6"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::getCallback" ref="a15598b577e10984206ec37ac67531cc6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="interfaceorg_1_1ccnx_1_1ccn_1_1_c_c_n_sync_handler.html">CCNSyncHandler</a> org.ccnx.ccn.impl.sync.SliceComparator.getCallback </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get callback associated with this comparator. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the callback </dd></dl>

</div>
</div>
<a class="anchor" id="a3e800b597dbd09f1c65c6aa308560d48"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::getPending" ref="a3e800b597dbd09f1c65c6aa308560d48" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classorg_1_1ccnx_1_1ccn_1_1impl_1_1sync_1_1_sync_tree_entry.html">SyncTreeEntry</a> org.ccnx.ccn.impl.sync.SliceComparator.getPending </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the best (highest hash) pending entry for a new comparison. </p>
<p>Also prunes duplicates out of the tree.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

</div>
</div>
<a class="anchor" id="ae85c4c1395e3ea909469c453054436ce"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::nextRound" ref="ae85c4c1395e3ea909469c453054436ce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.impl.sync.SliceComparator.nextRound </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start a new round of comparison. </p>
<p>_currentRoot holds the head of the last Y hash tree so we move it to X (_current) here. </p>

</div>
</div>
<a class="anchor" id="ac30dfa3d06b2f26cb549242396b684e2"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::run" ref="ac30dfa3d06b2f26cb549242396b684e2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.impl.sync.SliceComparator.run </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Separate thread for running comparisons. </p>
<p>We run until we can't do anything anymore, then rely on "kickCompare" to restart the thread. It uses a state machine to figure out where it left off and where to start back in again. </p>

</div>
</div>
<a class="anchor" id="ac5959d639a00dc604cd539aeda84871b"></a><!-- doxytag: member="org::ccnx::ccn::impl::sync::SliceComparator::updateCurrent" ref="ac5959d639a00dc604cd539aeda84871b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void org.ccnx.ccn.impl.sync.SliceComparator.updateCurrent </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>We keep a running tree of what we already have in "X". </p>
<p>Update it here to reflect what we got on the last round. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/org/ccnx/ccn/impl/sync/SliceComparator.java</li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Oct 3 00:11:59 2012 for Content-Centric Networking in Java by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
